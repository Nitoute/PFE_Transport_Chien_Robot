<launch>
    <arg name="use_rviz" default="false" />
    <arg name="use_rtabmapviz" default="false" />
    <arg name="keyboard_control" default="false"
        doc="Whether to launch keyboard control for the robot or not." />

    <group ns="rtabmap">
        <include file="$(find unitree_nav)/launch/go1_bringup.launch">
            <arg name="keyboard_control" value="$(arg keyboard_control)" />
        </include>
        <node name="rtabmap" pkg="rtabmap_ros" type="rtabmap" output="screen"
            args="--delete_db_on_start">

            <param name="frame_id" type="string" value="base_link" />
            <param name="approx_sync" type="bool" value="true" />
            <param name="subscribe_scan_cloud" type="bool" value="true" />

            <param name="subscribe_depth" type="bool" value="false"/>
            <param name="subscribe_rgbd" type="bool" value="false"/>
            <param name="subscribe_rgb" type="bool" value="false"/>
            <param name="subscribe_scan" type="bool" value="false"/>

            <remap from="scan_cloud" to="/camera1/point_cloud_face" />

            <param name="queue_size" type="int" value="10" />

            <!-- RTAB-Map's parameters -->
            <param name="RGBD/NeighborLinkRefining" type="string" value="true" />
            <param name="RGBD/ProximityBySpace" type="string" value="true" />
            <param name="RGBD/AngularUpdate" type="string" value="0.01" />
            <param name="RGBD/LinearUpdate" type="string" value="0.01" />
            <param name="RGBD/OptimizeFromGraphEnd" type="string" value="false" />
            <param name="Grid/FromDepth" type="string" value="false" /> <!-- occupancy grid from
            lidar -->
            <param name="Reg/Force3DoF" type="string" value="true" />
            <param name="Reg/Strategy" type="string" value="1" /> <!-- 1=ICP -->

            <!-- ICP parameters -->
            <param name="Icp/VoxelSize" type="string" value="0.05" />
            <param name="Icp/MaxCorrespondenceDistance" type="string" value="0.1" />
        </node>

        <node pkg="rviz" type="rviz" name="rviz" if="$(arg use_rviz)" />
        <node pkg="rtabmap_ros" type="rtabmapviz" name="rtabmapviz" if="$(arg use_rtabmapviz)" />
    </group>

</launch>